{% extends 'treeapp/base.html' %}
{% load static %}

{% block title %}{% if user.first_name and user.last_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %}'s Dashboard{% endblock %}

{% block extra_head %}
<script src="https://d3js.org/d3.v7.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
{# Removed FullCalendar CSS and JS from here as it will be in a separate page #}
<style>
/* User Dashboard */
.user-dashboard {
  padding: 20px;
  max-width: 1200px;
  margin: 0 auto;
}

.dashboard-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 32px;
  padding: 32px 40px 24px 40px;
  background: linear-gradient(120deg, #26394d 0%, #3887b0 100%);
  border-radius: 28px;
  box-shadow: 0 8px 32px rgba(30, 60, 90, 0.10);
  margin-bottom: 24px;
  max-width: 1100px;
  margin-left: auto;
  margin-right: auto;
  position: relative;
}
.dashboard-header-left {
  display: flex;
  align-items: center;
  gap: 32px;
}
.dashboard-header-right {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 0;
  min-width: 320px;
}
.profile-pic {
  width: 110px;
  height: 110px;
  border-radius: 50%;
  object-fit: cover;
  box-shadow: 0 2px 12px rgba(0,0,0,0.10);
  background: #fff;
  border: 4px solid #fff;
  /* Ensure default text is hidden if no image and no initials */
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2rem;
  font-weight: 500;
  color: #888;
}

/* Ensure the default avatar (div with initial) has proper styling */
.profile-pic.default-avatar {
  background: linear-gradient(135deg, #4a6bff, #6c5ce7);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem; /* Larger for better visibility */
  font-weight: 600;
  border: none; /* Override any img border */
}

.user-info {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: center;
  gap: 8px;
}
.user-info .welcome {
  font-size: 1.3rem;
  color: #fff;
  font-weight: 500;
  margin-bottom: 2px;
}
.user-info .username {
  font-size: 2.1rem;
  font-weight: 700;
  color: #fff;
  margin-bottom: 0;
  display: flex;
  align-items: center;
  gap: 12px;
}
.user-info .verified-badge {
  background: #2ecc71;
  color: #fff;
  font-size: 1rem;
  font-weight: 600;
  border-radius: 18px;
  padding: 2px 16px;
  margin-left: 10px;
  display: inline-block;
}
.user-info .fathername {
  font-size: 1.1rem;
  color: #e0e0e0;
  font-weight: 500;
  margin-bottom: 0;
  display: flex;
  align-items: center;
  gap: 6px;
}

/* Message Cards */
#notifications-container {
  margin-top: 0;
  margin-bottom: 0;
  text-align: left;
  max-width: 600px;
  margin-left: 0;
}
.birthday-msg, .custom-notification, .anniversary-msg {
  position: relative;
  margin: 8px 0; /* Reduced margin for closer stacking */
  border-radius: 16px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  font-size: 0.95rem; /* Slightly smaller font */
  font-weight: 600;
  min-height: 32px; /* Reduced height */
  padding: 8px 12px 8px 12px; /* Reduced padding */
  display: block; /* Ensure each message takes full width and new line */
  width: fit-content; /* Adjust width to content */
  max-width: calc(100% - 24px); /* Max width with padding considered */
  box-sizing: border-box; /* Include padding in width */
  transition: box-shadow 0.2s;
  line-height: 1.4;
}
.birthday-msg {
  background: linear-gradient(90deg,#ffe259,#ffa751);
  color: #b26500;
}
.custom-notification {
  background: linear-gradient(90deg,#6a1b9a,#b71c1c);
  color: #fff;
}
.anniversary-msg {
  background: linear-gradient(90deg, #ff7e5f, #feb47b); /* Warm gradient */
  color: #a04000; /* Dark orange text */
}
.birthday-msg .close-btn, .custom-notification .close-btn, .anniversary-msg .close-btn {
  position: absolute;
  top: 5px; /* Adjust top for better alignment */
  right: 5px; /* Adjust right for better alignment */
  background: rgba(255,255,255,0.8); /* Slightly more transparent */
  border: none;
  border-radius: 50%;
  width: 22px; /* Smaller button */
  height: 22px; /* Smaller button */
  cursor: pointer;
  font-size: 0.9rem; /* Smaller font for icon */
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  transition: background 0.2s, transform 0.2s;
  z-index: 2;
  outline: none;
  opacity: 1; /* Make permanent */
}
.birthday-msg .close-btn:hover, .custom-notification .close-btn:hover, .anniversary-msg .close-btn:hover {
  background: rgba(255,255,255,1); /* Fully opaque on hover */
  transform: scale(1.1); /* Slight pop effect */
}
.birthday-msg .close-btn span {
  color: #b26500; /* Match birthday text color */
  font-size: 0.9rem;
}
.custom-notification .close-btn span {
  color: #8e24aa; /* Match custom notification text color */
  font-size: 0.9rem;
}
.anniversary-msg .close-btn span {
  color: #a04000; /* Match anniversary text color */
  font-size: 0.9rem;
}
@media (max-width: 900px) {
  .dashboard-header {
    flex-direction: column;
    align-items: center;
    padding: 24px 10px 18px 10px;
    gap: 18px;
  }
  .dashboard-header-left {
    flex-direction: column;
    align-items: center;
    gap: 18px;
  }
  .dashboard-header-right {
    align-items: center;
    min-width: 0;
    width: 100%;
    margin-top: 10px;
  }
}

.username-header {
  background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
  padding: 25px 30px;
  border-radius: 16px;
  margin-bottom: 25px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  color: white;
}

.profile-header-content {
  display: flex;
  align-items: center;
  gap: 25px;
  max-width: 1200px;
  margin: 0 auto;
}

.profile-avatar-small {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  overflow: hidden;
  background: white;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  flex-shrink: 0;
  border: 3px solid rgba(255, 255, 255, 0.2);
  transition: transform 0.3s ease;
}

.profile-avatar-small:hover {
  transform: scale(1.05);
}

.profile-avatar-small img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.profile-avatar-small .default-avatar {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #3498db;
  color: white;
  font-size: 2rem;
  font-weight: 500;
}

.profile-info-small {
  flex: 1;
}

.profile-main-info {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 12px;
}

.profile-main-info h1 {
  font-size: 1.8rem;
  color: #ecf0f1;
  margin: 0;
  font-weight: 600;
  letter-spacing: 0.5px;
  min-width: 200px;
}

.verified-badge-small {
  display: flex;
  align-items: center;
  gap: 6px;
  background: rgba(46, 213, 115, 0.2);
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 500;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(46, 213, 115, 0.3);
}

.verified-badge-small span:first-child {
  color: #2ed573;
  font-size: 1.1rem;
}

.profile-details {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
}

.profile-detail {
  display: flex;
  align-items: center;
  gap: 8px;
  background: rgba(255, 255, 255, 0.1);
  padding: 8px 16px;
  border-radius: 12px;
  font-size: 0.95rem;
  backdrop-filter: blur(5px);
  border: 1px solid rgba(255, 255, 255, 0.1);
  transition: all 0.3s ease;
  min-width: 200px;
}

.profile-detail:hover {
  background: rgba(255, 255, 255, 0.15);
  transform: translateY(-2px);
}

.detail-icon-small {
  font-size: 1.1rem;
  opacity: 0.9;
  color: #3498db;
}

.detail-text {
  color: #ecf0f1;
  font-weight: 500;
  opacity: 0.95;
  font-size: 1.1rem;
  letter-spacing: 0.3px;
}

.profile-detail.verified-account {
  background: #00b894;
  color: white;
  font-weight: 500;
}

.profile-info-small .profile-detail {
  display: flex;
  align-items: center;
  gap: 5px;
  margin-bottom: 3px;
}

.edit-profile-btn {
  background: rgba(255, 255, 255, 0.2);
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: all 0.3s ease;
}

.edit-profile-btn:hover {
  background: rgba(255, 255, 255, 0.3);
  transform: translateY(-2px);
}

/* Tab Navigation */
.tab-container {
  background: white;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  overflow: hidden;
}

.tab-navigation {
  display: flex;
  background: #f8fafc;
  border-bottom: 1px solid #eaeaea;
  overflow-x: auto;
  scrollbar-width: none;
}
.tab-navigation::-webkit-scrollbar {
  display: none;
}

.tab-button {
  padding: 15px 25px;
  background: none;
  border: none;
  font-size: 1rem;
  font-weight: 500;
  color: #636e72;
  cursor: pointer;
  white-space: nowrap;
  position: relative;
  transition: all 0.3s ease;
}
.tab-button:hover {
  color: #4a6bff;
}
.tab-button.active {
  color: #4a6bff;
  font-weight: 600;
}
.tab-button.active::after {
  content: '';
  position: absolute;
  bottom: 0;
  left: 0;
  width: 100%;
  height: 3px;
  background: #4a6bff;
  border-radius: 3px 3px 0 0;
}
.tab-button .tab-icon {
  margin-right: 8px;
  font-size: 1.2rem;
}

.tab-content {
  padding: 25px;
  min-height: 400px;
}

.tab-panel {
  display: none;
  padding: 20px;
}
.tab-panel.active {
  display: block;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* Posts */
.posts-container {
  display: flex;
  flex-direction: column;
  gap: 20px;
}
.modern-post {
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  padding: 20px;
  border-left: 4px solid #4a6bff;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.modern-post:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}
.post-title {
  font-size: 1.4rem;
  margin-bottom: 10px;
  color: #2d3436;
}
.post-meta {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
  font-size: 0.9rem;
}
.post-category {
  background: #e8efff;
  color: #4a6bff;
  padding: 3px 10px;
  border-radius: 20px;
  font-weight: 500;
}
.post-info, .post-content {
  color: #636e72;
}
.post-content {
  line-height: 1.6;
  margin-bottom: 15px;
}
.post-actions {
  display: flex;
  gap: 15px;
}
.post-actions a {
  color: #4a6bff;
  text-decoration: none;
  font-weight: 500;
  font-size: 0.9rem;
  transition: color 0.2s ease;
}
.post-actions a:hover {
  color: #3a5ae8;
  text-decoration: underline;
}

/* Blood Bank Cards */
.blood-bank-cards {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-bottom: 30px;
}
.blood-card {
  flex: 1;
  min-width: 250px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  overflow: hidden;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.blood-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
}
.blood-card-header {
  padding: 15px;
  text-align: center;
  color: white;
  font-weight: 600;
  font-size: 1.2rem;
}
.blood-donor-header {
  background: linear-gradient(135deg, #27ae60, #2ecc71);
}
.blood-need-header {
  background: linear-gradient(135deg, #e74c3c, #ff7675);
}
.blood-card-body {
  padding: 15px;
  text-align: center;
}
.blood-card-icon {
  font-size: 2.5rem;
  margin-bottom: 10px;
}
.blood-card-text {
  color: #636e72;
  margin-bottom: 15px;
  line-height: 1.5;
  font-size: 0.95rem;
}
.blood-card-btn {
  display: inline-block;
  padding: 8px 18px;
  background: #4a6bff;
  color: white;
  border-radius: 6px;
  font-weight: 500;
  text-decoration: none;
  transition: all 0.2s ease;
}
.blood-card-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
}
.donor-status {
  display: inline-block;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: 500;
  margin-bottom: 15px;
}
.donor-active {
  background: #e3fcef;
  color: #00b894;
  border: 1px solid #b3f0d7;
}

/* Albums */
.album-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
}
.album-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.album-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
}
.album-thumbnail {
  height: 180px;
  overflow: hidden;
  position: relative;
}
.album-thumbnail img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}
.album-card:hover .album-thumbnail img {
  transform: scale(1.05);
}
.album-thumbnail .no-image {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f1f5f9;
  color: #b2bec3;
  font-weight: 500;
}
.album-info {
  padding: 15px;
}
.album-info h3 {
  margin: 0 0 5px 0;
  font-size: 1.1rem;
  color: #2d3436;
}
.album-date {
  display: block;
  color: #b2bec3;
  font-size: 0.8rem;
  margin-bottom: 8px;
}
.album-info p {
  margin: 0;
  color: #636e72;
  font-size: 0.9rem;
}
.album-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 15px;
}
.album-action-btn {
  display: inline-block;
  padding: 6px 15px;
  background: #4a6bff;
  color: white;
  border-radius: 6px;
  font-size: 0.9rem;
  font-weight: 500;
  text-decoration: none;
  transition: all 0.2s ease;
}
.album-action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 50px 20px;
  background: white;
  border-radius: 12px;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
  max-width: 500px;
  margin: 0 auto;
}
.empty-icon {
  font-size: 3rem;
  margin-bottom: 15px;
  color: #b2bec3;
}
.empty-state h3 {
  margin: 0 0 10px 0;
  color: #2d3436;
}
.empty-state p {
  color: #636e72;
  margin-bottom: 20px;
}
.empty-action-btn {
  display: inline-block;
  padding: 10px 20px;
  background: #4a6bff;
  color: white;
  border-radius: 6px;
  font-weight: 500;
  text-decoration: none;
  transition: all 0.2s ease;
}
.empty-action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.05);
}

/* Tree Controls & Emojis */
.tree-controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}
.tree-control-btn {
  font-size: 1.3em;
  background: none;
  border: none;
  outline: none;
  color: #2c3e50;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.15s;
  display: inline-flex;
  align-items: center;
  gap: 6px;
}
.tree-control-btn:active {
  background: rgba(44,62,80,0.07);
}
.btn-text {
  display: inline;
  font-size: 1em;
  font-weight: 500;
  color: #2c3e50;
}
@media (max-width: 700px) {
  .btn-text {
    display: none;
  }
  .tree-control-btn {
    font-size: 1.7em;
    padding: 6px 8px;
    background: none !important;
    border: none !important;
    box-shadow: none !important;
  }
}

.emoji-fallback {
  display: none;
  justify-content: center;
  gap: 15px;
  margin: 10px 0;
}
.emoji-fallback span {
  font-size: 1.5rem;
}

/* Responsive */
@media (max-width: 768px) {
  .username-header {
    padding: 20px;
  }

  .profile-header-content {
    gap: 15px;
  }

  .profile-avatar-small {
    width: 60px;
    height: 60px;
  }

  .profile-info-small h1 {
    font-size: 1.5rem;
  }

  .profile-details {
    gap: 10px;
  }

  .profile-detail {
    padding: 6px 12px;
    font-size: 0.9rem;
  }
}
@media (max-width: 480px) {
  .username-header {
    padding: 15px;
  }

  .profile-header-content {
    flex-direction: column;
    text-align: center;
    gap: 15px;
  }

  .profile-main-info {
    flex-direction: column;
    gap: 10px;
  }

  .profile-details {
    justify-content: center;
  }
}
@media (min-width: 769px) {
  .emoji-fallback { display: none !important; }
}

/* Profile Styles */
.profile-container {
  max-width: 800px;
  margin: 0 auto;
}

.profile-header {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 30px;
  border-radius: 15px;
  margin-bottom: 30px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
}

.profile-avatar {
  width: 150px;
  height: 150px;
  border-radius: 50%;
  overflow: hidden;
  position: relative;
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.profile-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.profile-avatar .default-avatar {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #4a6bff, #6c5ce7);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 4rem;
}

.profile-info {
  flex: 1;
}

.profile-name-container {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 5px;
}

.profile-name {
  font-size: 2rem;
  color: #2d3436;
  margin: 0;
}

.btn-edit {
  background: #4a90e2;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s ease;
}

.btn-edit:hover {
  background: #357abd;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(74, 144, 226, 0.2);
}

.profile-username {
  color: #636e72;
  font-size: 1.1rem;
}

.profile-section {
  background: white;
  border-radius: 12px;
  padding: 25px;
  margin-bottom: 25px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.section-header {
  margin-bottom: 20px;
  padding-bottom: 15px;
  border-bottom: 2px solid #f1f2f6;
}

.section-header h2 {
  color: #2d3436;
  font-size: 1.3rem;
  margin: 0;
}

.profile-details {
  display: grid;
  gap: 20px;
}

.profile-detail {
  display: flex;
  align-items: flex-start;
  gap: 15px;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 10px;
  transition: all 0.3s ease;
}

.profile-detail:hover {
  background: #f1f2f6;
  transform: translateX(5px);
}

.detail-icon {
  font-size: 1.5rem;
  background: white;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
}

.detail-content {
  flex: 1;
}

.detail-label {
  display: block;
  color: #636e72;
  font-size: 0.9rem;
  margin-bottom: 5px;
}

.detail-value {
  color: #2d3436;
  font-size: 1.1rem;
  font-weight: 500;
}

.verified-badge {
  background: #00b894;
  color: white;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.8rem;
  margin-left: 10px;
}

.donor-badge {
  background: #e17055;
  color: white;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 0.8rem;
}

/* Enhanced Modal Styles */
.modal-content {
  background: white;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.modal-header {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 15px 15px 0 0;
  padding: 25px;
}

.modal-header h2 {
  color: #2d3436;
  font-size: 1.5rem;
  margin: 0;
}

.form-section {
  padding: 25px;
  border-bottom: 1px solid #f1f2f6;
}

.form-section:last-child {
  border-bottom: none;
}

.form-section h3 {
  color: #2d3436;
  font-size: 1.2rem;
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  color: #636e72;
  font-size: 0.95rem;
  margin-bottom: 8px;
  display: block;
}

.form-control {
  width: 100%;
  padding: 12px;
  border: 2px solid #dfe6e9;
  border-radius: 8px;
  font-size: 1rem;
  transition: all 0.3s ease;
}

.form-control:focus {
  border-color: #4a90e2;
  box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
  outline: none;
}

.form-actions {
  padding: 20px 25px;
  background: #f8f9fa;
  border-radius: 0 0 15px 15px;
  display: flex;
  justify-content: flex-end;
  gap: 15px;
}

.btn {
  padding: 10px 20px;
  border-radius: 8px;
  font-size: 1rem;
  font-weight: 500;
  transition: all 0.3s ease;
}

.btn-primary {
  background: #4a90e2;
  color: white;
  border: none;
}

.btn-primary:hover {
  background: #357abd;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(74, 144, 226, 0.2);
}

.btn-secondary {
  background: #dfe6e9;
  color: #2d3436;
  border: none;
}

.btn-secondary:hover {
  background: #b2bec3;
  transform: translateY(-2px);
}

/* Profile Details Styles */
.profile-details-container {
    background: white;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    margin-top: 30px;
}

.profile-section {
    margin-bottom: 30px;
}

.profile-section h2 {
    color: #2d3436;
    font-size: 1.3rem;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.profile-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.profile-label {
    color: #636e72;
    font-size: 0.9rem;
}

.profile-value {
    color: #2d3436;
    font-size: 1.1rem;
    font-weight: 500;
}

.verified-badge {
    display: inline-block;
    background: #00b894;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-left: 8px;
}

.unverified-badge {
    display: inline-block;
    background: #fdcb6e;
    color: #2d3436;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
    margin-left: 8px;
}

.donor-badge {
    display: inline-block;
    background: #e17055;
    color: white;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 0.8rem;
}

/* Form Styles */
.form-section {
    margin-bottom: 30px;
}

.form-section h2 {
    color: #2d3436;
    font-size: 1.3rem;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.email-change-container {
    display: flex;
    gap: 10px;
}

.email-change-container .form-control {
    flex: 1;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
    width: 18px;
    height: 18px;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 15px;
    margin-top: 30px;
}

/* JavaScript for form toggle */
.profile-detail.verified-account {
    color: white;
    font-weight: 500;
    background: #00b894;
    padding: 4px 12px;
    border-radius: 20px;
    display: inline-flex;
    align-items: center;
    gap: 5px;
}

.profile-detail.verified-account span:first-child {
    font-size: 1.1em;
}

.profile-actions-top {
    display: flex;
    justify-content: flex-end;
    margin: 20px 0;
    padding: 0 30px;
}

.profile-actions-top .btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    font-size: 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.profile-actions-top .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.alert-container {
    margin: 20px 30px;
}

.alert {
    padding: 15px 20px;
    border-radius: 8px;
    margin-bottom: 15px;
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 10px;
    animation: slideIn 0.3s ease-out;
}

.alert-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-danger {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}

.alert-info {
    background-color: #d1ecf1;
    color: #0c5460;
    border: 1px solid #bee5eb;
}

@keyframes slideIn {
    from {
        transform: translateY(-10px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    overflow-y: auto;
}

.modal-content {
    background-color: #fff;
    margin: 50px auto;
    padding: 0;
    width: 90%;
    max-width: 600px;
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    animation: modalSlideIn 0.3s ease-out;
}

.modal-header {
    padding: 20px;
    border-bottom: 1px solid #eee;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.modal-header h2 {
    margin: 0;
    font-size: 1.5rem;
    color: #333;
}

.close-modal {
    background: none;
    border: none;
    font-size: 1.5rem;
    color: #666;
    cursor: pointer;
    padding: 5px;
}

.close-modal:hover {
    color: #333;
}

.modal-body {
    padding: 20px;
}

@keyframes modalSlideIn {
    from {
        transform: translateY(-50px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.form-section {
    margin-bottom: 30px;
}

.form-section h3 {
    color: #333;
    margin-bottom: 15px;
    font-size: 1.1rem;
}

.form-group {
    margin-bottom: 20px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    color: #555;
    font-weight: 500;
}

.form-control {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 1rem;
}

.form-control:focus {
    border-color: #4a90e2;
    outline: none;
    box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.form-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
    margin-top: 20px;
}

.email-change-container {
    display: flex;
    gap: 10px;
}

.email-change-container .form-control {
    flex: 1;
}

.verified-badge {
    background-color: #00b894;
    color: white;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 0.8rem;
    margin-left: 8px;
}

.profile-father-name {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 10px;
    color: #2d3436;
    font-size: 1.1rem;
    background: rgba(255, 255, 255, 0.7);
    padding: 8px 15px;
    border-radius: 8px;
    backdrop-filter: blur(5px);
}

.father-icon {
    font-size: 1.2rem;
}

.form-note {
    margin-top: 10px;
    padding: 12px;
    background: #f8f9fa;
    border-radius: 8px;
    display: flex;
    align-items: flex-start;
    gap: 10px;
    color: #636e72;
    font-size: 0.9rem;
    line-height: 1.4;
}

.note-icon {
    font-size: 1.1rem;
    color: #4a90e2;
}

/* Father's name styling in header */
.profile-detail.father-header {
    background: transparent;
    color: #d6eaff;
    font-weight: 500;
    font-size: 1.2rem;
    box-shadow: none;
    padding: 0 0 0 0.2em;
    margin-top: 0.2em;
}

/* Verified donor badge */
.verified-donor-badge {
    display: inline-flex;
    align-items: center;
    gap: 7px;
    background: linear-gradient(90deg, #00b894 60%, #43e97b 100%);
    color: #fff;
    font-weight: 600;
    font-size: 1rem;
    border-radius: 20px;
    padding: 6px 18px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    margin-top: 10px;
    margin-bottom: 10px;
    letter-spacing: 0.5px;
    border: none;
}
.verified-donor-badge .donor-check {
    font-size: 1.2em;
    color: #fff;
}

.donate-blood-cta {
    margin-bottom: 18px;
    padding: 18px 0 10px 0;
}
.donate-slogan {
    font-size: 1.2rem;
    font-weight: 600;
    color: #d63031;
    margin-bottom: 10px;
    letter-spacing: 0.5px;
}
.btn-danger {
    background: linear-gradient(90deg, #d63031 60%, #e17055 100%);
    color: #fff;
    border: none;
    border-radius: 20px;
    padding: 10px 28px;
    font-size: 1rem;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(214,48,49,0.08);
    transition: all 0.2s;
}
.btn-danger:hover {
    background: linear-gradient(90deg, #e17055 60%, #d63031 100%);
    transform: translateY(-2px) scale(1.04);
    box-shadow: 0 4px 16px rgba(214,48,49,0.15);
}

/* Responsive Profile & Forms */
@media (max-width: 900px) {
  .profile-header, .profile-container {
    flex-direction: column !important;
    align-items: stretch !important;
    padding: 18px !important;
  }
  .profile-header {
    gap: 18px !important;
    padding: 18px !important;
  }
  .profile-avatar, .profile-avatar-small {
    margin: 0 auto 12px auto !important;
    width: 70px !important;
    height: 70px !important;
  }
  .profile-info, .profile-info-small {
    align-items: center !important;
    text-align: center !important;
  }
  .profile-section {
    padding: 14px !important;
    margin-bottom: 16px !important;
  }
  .profile-details {
    gap: 10px !important;
    flex-direction: column !important;
  }
  .profile-detail {
    flex-direction: row !important;
    justify-content: flex-start !important;
    font-size: 1em !important;
    padding: 10px !important;
  }
  .profile-name-container {
    flex-direction: column !important;
    gap: 8px !important;
    align-items: center !important;
  }
  .profile-name {
    font-size: 1.2rem !important;
  }
  .profile-username {
    font-size: 1rem !important;
  }
  .profile-actions-top {
    justify-content: center !important;
    padding: 0 !important;
    margin: 10px 0 !important;
  }
  .profile-actions-top .btn {
    width: 100% !important;
    justify-content: center !important;
  }
  .profile-form, .album-form, .post-form {
    padding: 10px !important;
    border-radius: 10px !important;
    box-shadow: none !important;
    width: 100% !important;
    max-width: 100vw !important;
  }
  .form-section, .form-group {
    padding: 0 !important;
    margin-bottom: 14px !important;
  }
  .form-actions {
    flex-direction: column !important;
    gap: 10px !important;
    padding: 0 !important;
  }
  .form-actions .btn {
    width: 100% !important;
    margin: 0 !important;
  }
  .modal-content {
    width: 98vw !important;
    min-width: unset !important;
    max-width: 99vw !important;
    padding: 0 !important;
  }
  .modal-header, .modal-body, .form-section {
    padding: 14px !important;
  }
}
@media (max-width: 600px) {
  .profile-header, .profile-container {
    padding: 8px !important;
  }
  .profile-section {
    padding: 7px !important;
    margin-bottom: 10px !important;
  }
  .profile-avatar, .profile-avatar-small {
    width: 48px !important;
    height: 48px !important;
  }
  .profile-name {
    font-size: 1rem !important;
  }
  .profile-username {
    font-size: 0.95rem !important;
  }
  .profile-detail {
    font-size: 0.95em !important;
    padding: 7px !important;
  }
  .modal-content {
    width: 100vw !important;
    min-width: unset !important;
    max-width: 100vw !important;
    border-radius: 0 !important;
  }
}
@media (max-width: 700px) {
  .post-form, .album-form, .profile-form {
    padding: 15px !important;
    border-radius: 10px !important;
    max-width: calc(100% - 30px) !important;
    box-shadow: none !important;
    width: calc(100% - 30px) !important;
    margin: 0 15px !important;
  }
  
  .post-form .form-group,
  .album-form .form-group,
  .profile-form .form-group {
    margin-bottom: 15px !important;
    width: 100% !important;
    padding: 0 5px !important;
  }
  
  .post-form input,
  .post-form textarea,
  .album-form input,
  .album-form textarea,
  .profile-form input,
  .profile-form textarea,
  .form-control {
    font-size: 1em !important;
    padding: 8px !important;
    margin-bottom: 6px !important;
    width: 95% !important;
    max-width: 95% !important;
  }
  
  .post-form .form-actions,
  .album-form .form-actions,
  .profile-form .form-actions {
    flex-direction: column !important;
    gap: 8px !important;
    width: 100% !important;
    padding: 0 5px !important;
  }
  
  .post-form .form-actions .btn,
  .album-form .form-actions .btn,
  .profile-form .form-actions .btn {
    width: 93% !important;
    text-align: center !important;
    margin: 0 auto !important;
  }

  .btn-secondary {
    width: 93% !important;
    margin: 0 auto !important;
  }

  .modal-content {
    width: calc(100% - 30px) !important;
    margin: 15px !important;
    padding: 0 !important;
  }

  .modal-body {
    padding: 15px !important;
  }
}

@media (max-width: 480px) {
  .post-form input,
  .post-form textarea,
  .album-form input,
  .album-form textarea,
  .profile-form input,
  .profile-form textarea,
  .form-control {
    width: 95% !important;
    max-width: 95% !important;
  }

  .post-form .form-actions .btn,
  .album-form .form-actions .btn,
  .profile-form .form-actions .btn,
  .btn-secondary {
    width: 93% !important;
  }
}

/* Album grid and card fix */
@media (max-width: 700px) {
  .album-grid {
    grid-template-columns: 1fr !important;
    gap: 12px !important;
  }
  .album-card {
    min-width: 0 !important;
    width: 100% !important;
  }
  .album-thumbnail {
    height: 160px !important;
  }
}

/* Profile details fix */
@media (max-width: 700px) {
  .profile-details-container {
    padding: 10px !important;
  }
  .profile-detail {
    flex-direction: column !important;
    align-items: flex-start !important;
    gap: 4px !important;
    width: 100% !important;
    word-break: break-word !important;
  }
  .profile-detail .detail-content {
    width: 100% !important;
  }
}

.albums-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
  flex-wrap: wrap;
  gap: 15px;
}

.albums-actions h2 {
  margin: 0;
  color: #4a6bff;
}

.album-create-btn {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  background: #4a6bff;
  color: white !important;
  padding: 10px 20px;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 500;
  transition: all 0.3s ease;
  white-space: nowrap;
  font-size: 1rem;
}

.album-create-btn .btn-icon {
  font-size: 1.2rem;
  display: inline-flex;
  align-items: center;
}

.album-create-btn .btn-text {
  display: inline-block;
  color: white !important;
}

@media (max-width: 700px) {
  .albums-actions {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
    padding: 0 5px;
  }

  .albums-actions h2 {
    text-align: center;
    font-size: 1.3rem;
  }

  .album-create-btn {
    width: 100%;
    justify-content: center;
    padding: 12px 20px;
    font-size: 1rem;
  }

  .album-create-btn .btn-icon {
    font-size: 1.2rem;
  }

  .album-create-btn .btn-text {
    display: inline-block !important;
  }

  .empty-state .album-create-btn {
    width: 100%;
    justify-content: center;
    margin-top: 15px;
  }
  
}

@media (max-width: 480px) {
  .albums-actions {
    padding: 0;
  }

  .albums-actions h2 {
    font-size: 1.2rem;
  }

  .album-create-btn {
    padding: 10px 15px;
    font-size: 0.95rem;
  }

  .album-create-btn .btn-icon {
    font-size: 1.1rem;
  }
  .form-control
  {
    width: 95%;
  }
}

.post-form .form-control,
.album-form .form-control,
.profile-form .form-control,
.modal .form-control,
.form-section .form-control {
    width: 95% !important;
    max-width: 95% !important;
    padding: 12px 15px !important;
    border: 1px solid var(--border-color) !important;
    border-radius: 6px !important;
    font-size: 1rem !important;
    transition: border-color 0.2s ease !important;
    box-sizing: border-box !important;
}

@media (max-width: 700px) {
    .post-form .form-control,
    .album-form .form-control,
    .profile-form .form-control,
    .modal .form-control,
    .form-section .form-control {
        width: 95% !important;
        max-width: 95% !important;
        padding: 10px 12px !important;
    }

    .post-form .form-actions .btn,
    .album-form .form-actions .btn,
    .profile-form .form-actions .btn,
    .modal .form-actions .btn,
    .form-section .form-actions .btn {
        width: 93% !important;
        margin: 0 auto !important;
    }

    .btn-secondary {
        width: 93% !important;
        margin: 0 auto !important;
    }
}

@media (max-width: 480px) {
    .post-form .form-control,
    .album-form .form-control,
    .profile-form .form-control,
    .modal .form-control,
    .form-section .form-control {
        width: 95% !important;
        max-width: 95% !important;
        padding: 8px 10px !important;
    }

    .post-form .form-actions .btn,
    .album-form .form-actions .btn,
    .profile-form .form-actions .btn,
    .modal .form-actions .btn,
    .form-section .form-actions .btn,
    .btn-secondary {
        width: 93% !important;
    }
}

/* Add this at the very top of your style section */
#editProfileModal .form-control,
#editProfileModal input[type="text"],
#editProfileModal input[type="email"],
#editProfileModal input[type="tel"],
#editProfileModal input[type="date"],
#editProfileModal select,
#editProfileModal textarea {
    width: 95% !important;
    max-width: 95% !important;
    box-sizing: border-box !important;
}

#editProfileModal .form-actions .btn,
#editProfileModal .btn-secondary {
    width: 93% !important;
    margin: 0 auto !important;
}

@media (max-width: 700px) {
    #editProfileModal .form-control,
    #editProfileModal input[type="text"],
    #editProfileModal input[type="email"],
    #editProfileModal input[type="tel"],
    #editProfileModal input[type="date"],
    #editProfileModal select,
    #editProfileModal textarea {
        width: 95% !important;
        max-width: 95% !important;
        padding: 10px 12px !important;
    }

    #editProfileModal .form-actions .btn,
    #editProfileModal .btn-secondary {
        width: 93% !important;
        margin: 0 auto !important;
    }
}

@media (max-width: 480px) {
    #editProfileModal .form-control,
    #editProfileModal input[type="text"],
    #editProfileModal input[type="email"],
    #editProfileModal input[type="tel"],
    #editProfileModal input[type="date"],
    #editProfileModal select,
    #editProfileModal textarea {
        width: 95% !important;
        max-width: 95% !important;
        padding: 8px 10px !important;
    }

    #editProfileModal .form-actions .btn,
    #editProfileModal .btn-secondary {
        width: 93% !important;
    }
}

.btn-change-email {
    background: linear-gradient(90deg, #4a6bff, #6c5ce7);
    color: #fff;
    border: none;
    padding: 12px 25px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    flex-shrink: 0;
    margin-left: 10px;
}
.btn-change-email:hover {
    background: linear-gradient(90deg, #3a5bef, #5c4cd7);
    box-shadow: 0 5px 15px rgba(74, 107, 255, 0.3);
}
@media (max-width: 600px) {
    .email-change-container {
        flex-direction: column;
        gap: 10px;
    }
    .btn-change-email {
        width: 100%;
        margin-left: 0;
    }
}

.btn-change-email-modal {
    background: linear-gradient(90deg, #4a6bff, #6c5ce7);
    color: #fff;
    border: none;
    padding: 12px 25px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    margin-left: 10px;
}
.btn-change-email-modal:hover {
    background: linear-gradient(90deg, #3a5bef, #5c4cd7);
    box-shadow: 0 5px 15px rgba(74, 107, 255, 0.3);
}
@media (max-width: 600px) {
    .modal .form-actions {
        flex-direction: column;
        gap: 10px;
    }
    .btn-change-email-modal {
        width: 100%;
        margin-left: 0;
    }
    .modal .form-actions .btn {
        width: 100%;
    }
}

.email-action-btn {
    background: linear-gradient(90deg, #4a6bff, #6c5ce7);
    color: #fff;
    border: none;
    padding: 12px 25px;
    border-radius: 6px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
    flex-shrink: 0;
    margin-left: 10px;
}
.email-action-btn:hover {
    background: linear-gradient(90deg, #3a5bef, #5c4cd7);
    box-shadow: 0 5px 15px rgba(74, 107, 255, 0.3);
}
@media (max-width: 600px) {
    .email-change-container {
        flex-direction: column;
        gap: 10px;
    }
    .email-action-btn {
        width: 100%;
        margin-left: 0;
    }
    .modal .form-actions {
        flex-direction: column;
        gap: 10px;
    }
    .modal .form-actions .btn,
    .modal .form-actions .email-action-btn {
        width: 100%;
    }
}

.verified-tick-anim {
  display: inline-block;
  opacity: 0;
  transform: scale(0.5);
  animation: tick-pop 0.5s cubic-bezier(0.4,1.4,0.6,1) 0.1s forwards;
}
@keyframes tick-pop {
  0% { opacity: 0; transform: scale(0.5); }
  60% { opacity: 1; transform: scale(1.2); }
  100% { opacity: 1; transform: scale(1); }
}
.verified-text-anim {
  opacity: 0;
  animation: text-fadein 0.5s ease 0.5s forwards;
}
@keyframes text-fadein {
  from { opacity: 0; }
  to { opacity: 1; }
}

@media (max-width: 600px) {
  .posts-actions {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 10px;
  }
  .posts-actions a.tree-control-btn {
    order: 1;
    width: 100%;
    margin-bottom: 0;
  }
  .posts-actions h2 {
    order: 2;
    text-align: left;
    margin-top: 0;
  }
}

.add-post-mobile-text {
  display: none;
}
@media (max-width: 600px) {
  .add-post-mobile-text {
    display: inline;
    margin-left: 6px;
    font-weight: 500;
  }
  .tree-control-btn {
    font-size: 1.05rem;
  }
  .tree-control-btn > :not(.add-post-mobile-text):not(.btn-icon) {
    display: none;
  }
}

.default-avatar {
  background: linear-gradient(135deg, #4a6bff, #6c5ce7);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5rem; /* Larger for better visibility */
  font-weight: 600;
  border: none; /* Override any img border */
}

/* Calendar Styles */
.calendar-container {
    background: white;
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.fc-event {
    cursor: pointer;
    padding: 2px 4px;
    border-radius: 3px;
}

.fc-event.birthday {
    background-color: #4CAF50;
    border-color: #4CAF50;
}

.fc-event.anniversary {
    background-color: #2196F3;
    border-color: #2196F3;
}

.fc-toolbar-title {
    font-size: 1.2em !important;
    font-weight: 600;
}

.fc-button-primary {
    background-color: #4CAF50 !important;
    border-color: #4CAF50 !important;
}

.fc-button-primary:hover {
    background-color: #45a049 !important;
    border-color: #45a049 !important;
}
</style>

{% endblock %}

{% block content %}
<div class="user-dashboard">
    <div class="dashboard-header">
        <div class="dashboard-header-left">
            {% if user_profile.picture %}
                <img src="{{ user_profile.picture.url }}" class="profile-pic" alt="User Profile Picture">
            {% else %}
                <div class="profile-pic default-avatar">
                    {{ request.user.username.0|upper }}
                </div>
            {% endif %}
            <div class="user-info">
                <div class="welcome">Welcome</div>
                <div class="username">
                    {{ user_profile.name|default:request.user.get_full_name|default:request.user.username }}
                    {% if user_profile.is_verified %}
                        <span class="verified-badge">âœ” Verified</span>
                    {% endif %}
                </div>
                {% if user_profile.member_id and user_profile.member_id.parent %}
                    <div class="fathername">ğŸ‘¨â€ğŸ‘¦ {{ user_profile.member_id.parent.name }}</div>
                {% endif %}
            </div>
        </div>
        <div class="dashboard-header-right">
            {% for member in birthday_members %}
                <div class="birthday-msg" id="birthday-msg-{{ member.id }}">
                    <button class="close-btn" onclick="document.getElementById('birthday-msg-{{ member.id }}').style.display='none'">
                        <span>âœ–ï¸</span>
                    </button>
                    <span style="display:block;padding-right:28px;">ğŸ‰ Vashisht Family wishes <b>{{ member.name }}</b> a very happy birthday!</span>
                </div>
            {% endfor %}
            {% for notification in custom_notifications %}
                <div class="custom-notification" id="notification-{{ notification.id }}">
                    <button class="close-btn" onclick="document.getElementById('notification-{{ notification.id }}').style.display='none'">
                        <span>âœ–ï¸</span>
                    </button>
                    <span style="display:block;padding-right:28px;">ğŸ“¢ {{ notification.message }}</span>
                </div>
            {% endfor %}
            {% for member in anniversary_members %}
                <div class="anniversary-msg" id="anniversary-msg-{{ member.id }}">
                    <button class="close-btn" onclick="document.getElementById('anniversary-msg-{{ member.id }}').style.display='none'">
                        <span>âœ–ï¸</span>
                    </button>
                    <span style="display:block;padding-right:28px;">ğŸ’– Vashisht Family wishing happy anniversary to Mr and Mrs {{ member.name|default:member.user.get_full_name|default:member.user.username }} ğŸ’‘</span>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="tab-container">
        <div class="tab-navigation">
            <button class="tab-button active" data-tab="mytree">
                <span class="tab-icon">ğŸŒ³</span> My Tree
            </button>
            <button class="tab-button" data-tab="posts">
                <span class="tab-icon">ğŸ“</span> Posts
            </button>
            <button class="tab-button" data-tab="albums">
                <span class="tab-icon">ğŸ–¼ï¸</span> Albums
            </button>
            <button class="tab-button" data-tab="blood">
                <span class="tab-icon">ğŸ©¸</span> Blood Bank
            </button>
            <button class="tab-button" data-tab="profile">
                <span class="tab-icon">ğŸ‘¤</span> Profile
            </button>
            <button class="tab-button" data-tab="calendar">
                <span class="tab-icon">ğŸ“…</span> Calendar
            </button>
        </div>

        <div class="tab-content">
            <!-- My Tree Tab -->
            <div class="tab-panel active" id="mytree-panel">
                <div class="tree-controls">
                    <button id="reset-zoom" class="tree-control-btn">
                        <span class="btn-icon">ğŸ”</span> <span class="btn-text">Reset Zoom</span>
                    </button>
                    <button id="expand-all" class="tree-control-btn">
                        <span class="btn-icon">â•</span> <span class="btn-text">Expand All</span>
                    </button>
                    <button id="collapse-all" class="tree-control-btn">
                        <span class="btn-icon">â–</span> <span class="btn-text">Collapse All</span>
                    </button>
                </div>
                <div class="emoji-fallback">
                    <button id="reset-zoom-emoji" class="emoji-btn" title="Reset Zoom">ğŸ”</button>
                    <button id="expand-all-emoji" class="emoji-btn" title="Expand All">â•</button>
                    <button id="collapse-all-emoji" class="emoji-btn" title="Collapse All">â–</button>
                </div>

                {% if no_tree %}
                    <div style="text-align: center; padding: 50px 20px; background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); max-width: 600px; margin: 0 auto;">
                        <h2 style="color: #4a6bff; margin-bottom: 20px;">Your Family Tree</h2>
                        <p style="color: #666; margin-bottom: 20px;">Your account is not yet linked to the family tree. Please contact an administrator to set up your family connection.</p>
                    </div>
                {% else %}
                    <div id="tree-container" style="width: 100%; height: 70vh; position: relative;">
                        <svg id="tree-svg" width="100%" height="100%"></svg>
                        <div id="dynamic-modal-root" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; z-index: 1000; pointer-events: none;">
                            <!-- Modal content will be inserted here -->
                        </div>
                    </div>
                {% endif %}
            </div>

            <!-- Posts Tab -->
            <div class="tab-panel" id="posts-panel">
                <div class="posts-actions" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: #4a6bff;">My Posts</h2>
                    <a href="{% url 'add_post' %}" class="tree-control-btn" style="background: #4a6bff; color: white;">
                        <span class="btn-icon">âœï¸</span>
                        <span class="add-post-mobile-text">Add Post</span>
                        Create New Post
                    </a>
                </div>

                <div class="posts-container">
                    {% if user_posts %}
                        {% for post in user_posts %}
                            <div class="modern-post">
                                <h3 class="post-title">{{ post.title }}</h3>
                                <div class="post-meta">
                                    <span class="post-category">{{ post.get_category_display }}</span>
                                    <span class="post-info">Posted on {{ post.created_at|date:"M d, Y" }}</span>
                                </div>
                                <div class="post-content">{{ post.content|truncatewords:30 }}</div>
                                <div class="post-actions">
                                    <a href="{% url 'view_post' post.id %}">Read more</a>
                                    <a href="{% url 'edit_post' post.id %}">Edit</a>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ“</div>
                            <h3>No Posts Yet</h3>
                            <p>Share news, events, or family history with your first post.</p>
                            <a href="{% url 'add_post' %}" class="empty-action-btn">Create Post</a>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- Albums Tab -->
            <div class="tab-panel" id="albums-panel">
                <div class="albums-actions">
                    <h2>My Albums</h2>
                    <a href="{% url 'add_album' %}" class="album-create-btn">
                        <span class="btn-icon">ğŸ“¸</span>
                        <span class="btn-text">Create New Album</span>
                    </a>
                </div>

                <div class="albums-container">
                    {% if user_albums %}
                        <div class="album-grid">
                            {% for album in user_albums %}
                                <div class="album-card">
                                    <div class="album-thumbnail">
                                        {% if album.photos.first %}
                                            <img src="{{ album.photos.first.image.url }}" alt="{{ album.title }}">
                                        {% else %}
                                            <div class="no-image">No Photos</div>
                                        {% endif %}
                                    </div>
                                    <div class="album-info">
                                        <h3>{{ album.title }}</h3>
                                        <span class="album-date">{{ album.created_at|date:"M d, Y" }}</span>
                                        <p>{{ album.photos.count }} photos</p>
                                    </div>
                                    <div class="album-actions">
                                        <a href="{% url 'view_album' album.id %}" class="album-action-btn">View</a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <div class="empty-icon">ğŸ–¼ï¸</div>
                            <h3>No Albums Yet</h3>
                            <p>Create your first photo album to share memories with family.</p>
                            <a href="{% url 'add_album' %}" class="album-create-btn">
                                <span class="btn-icon">ğŸ“¸</span>
                                <span class="btn-text">Create New Album</span>
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Blood Bank Tab -->
            <div class="tab-panel" id="blood-panel">
                
                <div style="text-align: center; margin-top: 20px;">
                    {% if user_profile.is_blood_donor %}
                        <div class="verified-donor-badge">
                            <span class="donor-check">âœ“</span>
                            Verified donor
                        </div>
                        <button class="btn btn-primary" style="margin-top: 10px;">View all blood bank service</button>
                    {% else %}
                        <div class="donate-blood-cta">
                            <div class="donate-slogan">Be a hero, save a life! <span style="color:#e17055;">Donate Blood</span></div>
                            <button class="btn btn-danger" onclick="openDonateEditProfile()">Donate Blood</button>
                        </div>
                        <button class="btn btn-primary" style="margin-top: 10px;">View all blood bank service</button>
                    {% endif %}
                </div>
            </div>

            <!-- Profile Tab -->
            <div class="tab-panel" id="profile-panel">
                <div class="profile-container">
                    <div class="profile-header">
                        <div class="profile-avatar">
                            {% if user_profile.picture %}
                                <img src="{{ user_profile.picture.url }}" alt="{{ user.username }}">
                            {% else %}
                                <div class="default-avatar">
                                    {{ user.username.0|upper }}
                                </div>
                            {% endif %}
                        </div>
                        <div class="profile-info">
                            <div class="profile-name-container">
                                <h1 class="profile-name">{{ user_profile.name|default:user.username }}</h1>
                                <button class="btn btn-edit" onclick="showEditForm()">
                                    <span>âœï¸</span>
                                    Edit Profile
                                </button>
                            </div>
                            <div class="profile-username">@{{ user.username }}</div>
                            {% if user_profile.father_name %}
                            <div class="profile-father-name">
                                <span class="father-icon">ğŸ‘¨â€ğŸ‘¦</span>
                                <span>{{ user_profile.father_name }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <div class="profile-details-container">
                        <div class="profile-section">
                            <div class="section-header">
                                <h2>Personal Information</h2>
                            </div>
                            <div class="profile-details">
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸ‘¤</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Full Name</span>
                                        <span class="detail-value">{{ user_profile.name|default:"Not set" }}</span>
                                    </div>
                                </div>
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸ‘¨â€ğŸ‘¦</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Father's Name</span>
                                        <span class="detail-value">{{ user_profile.father_name|default:"Not set" }}</span>
                                    </div>
                                </div>
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸ“…</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Date of Birth</span>
                                        <span class="detail-value">{{ user_profile.date_of_birth|date:"F d, Y"|default:"Not set" }}</span>
                                    </div>
                                </div>
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸš»</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Gender</span>
                                        <span class="detail-value">{{ user_profile.get_gender_display|default:"Not set" }}</span>
                                    </div>
                                </div>
                                <div class="profile-detail">
                                    <div class="detail-icon">â¤ï¸</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Marital Status</span>
                                        <span class="detail-value">{{ user_profile.get_marital_status_display|default:"Not set" }}</span>
                                    </div>
                                </div>
                                {% if user_profile.marital_status == 'married' and user_profile.anniversary_date %}
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸ—“ï¸</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Anniversary Date</span>
                                        <span class="detail-value">{{ user_profile.anniversary_date|date:"F d, Y" }}</span>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="profile-section">
                            <div class="section-header">
                                <h2>Contact Information</h2>
                            </div>
                            <div class="profile-details">
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸ“§</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Email</span>
                                        <span class="detail-value">
                                            {{ user.email }}
                                            {% if user_profile.email_verified %}
                                                <span class="verified-badge">âœ“ Verified</span>
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸ“±</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Phone Number</span>
                                        <span class="detail-value">{{ user_profile.phone|default:"Not set" }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <div class="section-header">
                                <h2>Blood Information</h2>
                            </div>
                            <div class="profile-details">
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸ©¸</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Blood Group</span>
                                        <span class="detail-value">{{ user_profile.get_blood_group_display|default:"Not set" }}</span>
                                    </div>
                                </div>
                                <div class="profile-detail">
                                    <div class="detail-icon">ğŸ’‰</div>
                                    <div class="detail-content">
                                        <span class="detail-label">Donor Status</span>
                                        <span class="detail-value">
                                            {% if user_profile.is_blood_donor %}
                                                <span class="donor-badge">Willing to donate blood</span>
                                            {% else %}
                                                Not a blood donor
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Calendar Tab -->
            <div class="tab-panel" id="calendar-panel">
                <div style="text-align:center; padding: 50px 20px; background: white; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.08); max-width: 600px; margin: 0 auto;">
                    <h2 style="color: #4a6bff; margin-bottom: 20px;">View Your Calendar</h2>
                    <p style="color: #666; margin-bottom: 20px;">Click below to view your personalized calendar with birthdays and anniversaries.</p>
                    <a href="{% url 'calendar_page' %}" class="btn btn-primary">Go to Calendar</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Edit Profile Modal -->
<div id="editProfileModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Edit Profile</h2>
            <button class="close-modal" onclick="hideEditForm()">&times;</button>
        </div>
        <form id="editProfileForm" method="POST" action="{% url 'update_profile' %}" enctype="multipart/form-data" style="width: 100%;">
            {% csrf_token %}
            <div class="form-section">
                <h3>Personal Information</h3>
                <div class="form-group">
                    <label for="name">Full Name</label>
                    <input type="text" id="name" name="name" class="form-control" value="{{ user_profile.name|default:'' }}" required style="width: 95%;">
                </div>
                <div class="form-group">
                    <label for="father_name">Father's Name</label>
                    <input type="text" id="father_name" name="father_name" class="form-control" value="{{ user_profile.father_name|default:'' }}" style="width: 95%;">
                </div>
                <div class="form-group">
                    <label for="gender">Gender</label>
                    <select id="gender" name="gender" class="form-control" style="width: 95%;">
                        <option value="">Select Gender</option>
                        {% for value, label in user_profile.GENDER_CHOICES %}
                            <option value="{{ value }}" {% if user_profile.gender == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="marital_status">Marital Status</label>
                    <select id="marital_status" name="marital_status" class="form-control" style="width: 95%;">
                        <option value="">Select Marital Status</option>
                        <option value="single" {% if user_profile.marital_status == 'single' %}selected{% endif %}>Single</option>
                        <option value="married" {% if user_profile.marital_status == 'married' %}selected{% endif %}>Married</option>
                        <option value="divorced" {% if user_profile.marital_status == 'divorced' %}selected{% endif %}>Divorced</option>
                        <option value="widowed" {% if user_profile.marital_status == 'widowed' %}selected{% endif %}>Widowed</option>
                    </select>
                </div>
                <div class="form-group" id="anniversary_date_group" style="display: {% if user_profile.marital_status == 'married' %}block{% else %}none{% endif %};">
                    <label for="anniversary_date">Anniversary Date</label>
                    <input type="date" id="anniversary_date" name="anniversary_date" class="form-control" value="{{ user_profile.anniversary_date|date:'Y-m-d'|default:'' }}" style="width: 95%;">
                </div>
                <div class="form-group">
                    <label for="date_of_birth">Date of Birth</label>
                    <input type="date" id="date_of_birth" name="date_of_birth" class="form-control" value="{{ user_profile.date_of_birth|date:'Y-m-d'|default:'' }}" style="width: 95%;">
                </div>
            </div>

            <div class="form-section">
                <h3>Contact Information</h3>
                <div class="form-group">
                    <label for="email">Email</label>
                    <div class="email-change-container">
                        <input type="email" id="email" name="email" class="form-control" value="{{ user.email }}" required style="flex: 1; min-width: 0;">
                        <button type="button" class="email-action-btn" onclick="showEmailChangeModal()">Change Email</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" class="form-control" value="{{ user_profile.phone|default:'' }}" style="width: 95%;">
                </div>
            </div>

            <div class="form-section">
                <h3>Blood Information</h3>
                <div class="form-group">
                    <label for="blood_group">Blood Group</label>
                    <select id="blood_group" name="blood_group" class="form-control" style="width: 95%;">
                        <option value="">Select Blood Group</option>
                        {% for value, label in user_profile.BLOOD_GROUP_CHOICES %}
                            <option value="{{ value }}" {% if user_profile.blood_group == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="is_blood_donor" name="is_blood_donor" {% if user_profile.is_blood_donor %}checked{% endif %}>
                        I am willing to donate blood
                    </label>
                </div>
            </div>

            <div class="form-section">
                <h3>Profile Picture</h3>
                <div class="form-group">
                    <label for="picture">Profile Picture</label>
                    <input type="file" id="picture" name="picture" class="form-control" accept="image/*" style="width: 95%;">
                </div>
            </div>

            <div class="form-actions" style="display: flex; flex-direction: column; gap: 10px;">
                <button type="button" class="btn btn-secondary" style="width: 100%;" onclick="hideEditForm()">Cancel</button>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Save Changes</button>
            </div>
        </form>
    </div>
</div>

<!-- Email Change Modal -->
<div id="emailChangeModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Change Email Address</h2>
            <button class="close-modal" onclick="hideEmailChangeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p>Enter your new email address below. We'll send you a verification code to confirm the change.</p>
            <div class="form-group">
                <label for="new_email">New Email Address</label>
                <input type="email" id="new_email" class="form-control" required>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="hideEmailChangeModal()">Cancel</button>
                <button type="button" class="email-action-btn" onclick="requestEmailChange()">Send Verification Code</button>
            </div>
        </div>
    </div>
</div>

<!-- Donate Blood Modal -->
<div id="donateBloodModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Become a Blood Donor</h2>
            <button class="close-modal" onclick="hideDonateModal()">&times;</button>
        </div>
        <div class="modal-body">
            <p>Thank you for your willingness to help others! By becoming a blood donor, you can save lives in your community.</p>
            <form method="POST" action="{% url 'update_profile' %}">
                {% csrf_token %}
                <input type="hidden" name="is_blood_donor" value="on">
                <div class="form-group">
                    <label for="donor_blood_group">Select your Blood Group</label>
                    <select id="donor_blood_group" name="blood_group" class="form-control" required>
                        <option value="">Select Blood Group</option>
                        {% for value, label in user_profile.BLOOD_GROUP_CHOICES %}
                            <option value="{{ value }}" {% if user_profile.blood_group == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="hideDonateModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">Yes, I want to donate</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // === Emoji Control Logic ===
    const treeControlBtns = document.querySelectorAll('.tree-control-btn');
    if (treeControlBtns.length > 0) {
        treeControlBtns.forEach(btn => {
            btn.addEventListener('click', e => {
                const emojiSpan = document.querySelector(`.emoji-fallback span[title="${btn.textContent.trim()}"]`);
                if (emojiSpan) {
                    emojiSpan.classList.add('active-emoji', 'emojiclicked');
                    setTimeout(() => emojiSpan.classList.remove('emojiclicked'), 300);
                }
            });
        });
    }

    // === Emoji Click Triggers ===
    const emojiReset = document.getElementById('emoji-reset');
    const emojiExpand = document.getElementById('emoji-expand');
    const emojiCollapse = document.getElementById('emoji-collapse');
    const resetZoom = document.getElementById('reset-zoom');
    const expandAll = document.getElementById('expand-all');
    const collapseAll = document.getElementById('collapse-all');

    if (emojiReset && resetZoom) {
        emojiReset.addEventListener('click', () => resetZoom.click());
    }
    if (emojiExpand && expandAll) {
        emojiExpand.addEventListener('click', () => expandAll.click());
    }
    if (emojiCollapse && collapseAll) {
        emojiCollapse.addEventListener('click', () => collapseAll.click());
    }

    // === Tab Switching Logic ===
    const tabButtons = document.querySelectorAll('.tab-button');
    const tabPanels = document.querySelectorAll('.tab-panel');

    if (tabButtons.length > 0 && tabPanels.length > 0) {
        tabButtons.forEach(button => {
            button.addEventListener('click', function () {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabPanels.forEach(panel => panel.classList.remove('active'));

                this.classList.add('active');
                const tabId = this.getAttribute('data-tab');
                const targetPanel = document.getElementById(`${tabId}-panel`);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
            });
        });
    }

    // Emoji buttons trigger the original controls
    const resetZoomEmoji = document.getElementById('reset-zoom-emoji');
    const expandAllEmoji = document.getElementById('expand-all-emoji');
    const collapseAllEmoji = document.getElementById('collapse-all-emoji');

    if (resetZoomEmoji && resetZoom) {
        resetZoomEmoji.addEventListener('click', () => resetZoom.click());
    }
    if (expandAllEmoji && expandAll) {
        expandAllEmoji.addEventListener('click', () => expandAll.click());
    }
    if (collapseAllEmoji && collapseAll) {
        collapseAllEmoji.addEventListener('click', () => collapseAll.click());
    }

    // Initialize default avatar if needed
    const defaultAvatars = document.querySelectorAll('.default-avatar');
    defaultAvatars.forEach(avatar => {
        if (!avatar.querySelector('img')) {
            avatar.innerHTML = avatar.textContent.trim().charAt(0).toUpperCase();
        }
    });

    // Conditional display for anniversary date
    const maritalStatusSelect = document.getElementById('marital_status');
    const anniversaryDateGroup = document.getElementById('anniversary_date_group');

    if (maritalStatusSelect && anniversaryDateGroup) {
        maritalStatusSelect.addEventListener('change', function() {
            if (this.value === 'married') {
                anniversaryDateGroup.style.display = 'block';
            } else {
                anniversaryDateGroup.style.display = 'none';
            }
        });
    }
});

function showEditForm() {
    document.getElementById('editProfileModal').style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function hideEditForm() {
    document.getElementById('editProfileModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

function showEmailChangeModal() {
    document.getElementById('emailChangeModal').style.display = 'block';
}

function hideEmailChangeModal() {
    document.getElementById('emailChangeModal').style.display = 'none';
}

function requestEmailChange() {
    const newEmail = document.getElementById('new_email').value;
    if (!newEmail) {
        alert('Please enter a new email address');
        return;
    }
    
    // Send request to change email
    fetch('{% url "update_profile" %}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify({
            email: newEmail,
            action: 'change_email'
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            hideEmailChangeModal();
            // Show success message in a more elegant way
            const successMessage = document.createElement('div');
            successMessage.className = 'success-message';
            successMessage.textContent = 'Verification code sent to your new email address';
            document.querySelector('.profile-container').prepend(successMessage);
            setTimeout(() => successMessage.remove(), 5000);
        } else {
            alert(data.message || 'An error occurred');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while processing your request');
    });
}

function openDonateEditProfile() {
    showEditForm();
    setTimeout(function() {
        var donorCheckbox = document.getElementById('is_blood_donor');
        if (donorCheckbox) {
            donorCheckbox.checked = true;
        }
        var bloodGroup = document.getElementById('blood_group');
        if (bloodGroup) {
            bloodGroup.scrollIntoView({behavior: 'smooth', block: 'center'});
            bloodGroup.focus();
        }
    }, 300);
}

function hideDonateModal() {
    document.getElementById('donateBloodModal').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Close modals when clicking outside
window.onclick = function(event) {
    if (event.target.className === 'modal') {
        event.target.style.display = 'none';
        document.body.style.overflow = 'auto';
    }
}

// Initialize Calendar
document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    if (calendarEl) {
        console.log('calendar_events raw:', `{{ calendar_events|escapejs }}`);
        const parsedEvents = JSON.parse(`{{ calendar_events|escapejs }}`);
        console.log('calendar_events parsed:', parsedEvents);

        const calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,dayGridYear'
            },
            events: parsedEvents,
            // eventContent and eventDidMount are temporarily removed for debugging
            // eventClick: function(info) {
            //     alert(`${info.event.title}'s ${info.event.extendedProps.type}`);
            // }
        });
        calendar.render();

        // Add reset button functionality
        const resetBtn = document.getElementById('resetCalendarBtn');
        if (resetBtn) {
            resetBtn.addEventListener('click', function() {
                calendar.today();
            });
        }
    }
});
</script>


{% if not no_tree %}
<script>
    window.IS_MY_TREE = true;
    window.EDIT_MEMBER_URL = "{% url 'edit_member' 0 %}".replace('0', '{id}');
    window.USER_TREE_DATA = {{ tree_data_json|safe }};
    window.userNodeId = {{ member_id|default:"null" }};
    window.EDITABLE_ANCESTORS = {{ editable_ancestors|default:"[]"|safe }};
</script>
<script src="{% static 'treeapp/js/fixed-tree.js' %}"></script>
<script src="{% static 'treeapp/js/api-tree.js' %}"></script>
{% endif %}
{% endblock %}